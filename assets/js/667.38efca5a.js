"use strict";(self.webpackChunkgetocc=self.webpackChunkgetocc||[]).push([[667],{5048:(e,t,r)=>{r.r(t),r.d(t,{PLYLoader:()=>a});var n=r(4922);const s=new n.Q1f;class a extends n.aHM{constructor(e){super(e),this.propertyNameMapping={},this.customPropertyMapping={}}load(e,t,r,s){const a=this,o=new n.Y9S(this.manager);o.setPath(this.path),o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,function(r){try{t(a.parse(r))}catch(n){s?s(n):console.error(n),a.manager.itemError(e)}},r,s)}setPropertyNameMapping(e){this.propertyNameMapping=e}setCustomPropertyNameMapping(e){this.customPropertyMapping=e}parse(e){function t(e,t=0){let r="";const n=/^ply([\s\S]*)end_header(\r\n|\r|\n)/.exec(e);null!==n&&(r=n[1]);const s={comments:[],elements:[],headerLength:t,objInfo:""},a=r.split(/\r\n|\r|\n/);let o;function c(e,t){const r={type:e[0]};return"list"===r.type?(r.name=e[3],r.countType=e[1],r.itemType=e[2]):r.name=e[1],r.name in t&&(r.name=t[r.name]),r}for(let i=0;i<a.length;i++){let e=a[i];if(e=e.trim(),""===e)continue;const t=e.split(/\s+/),r=t.shift();switch(e=t.join(" "),r){case"format":s.format=t[0],s.version=t[1];break;case"comment":s.comments.push(e);break;case"element":void 0!==o&&s.elements.push(o),o={},o.name=t[0],o.count=parseInt(t[1]),o.properties=[];break;case"property":o.properties.push(c(t,m.propertyNameMapping));break;case"obj_info":s.objInfo=e;break;default:console.log("unhandled",r,t)}}return void 0!==o&&s.elements.push(o),s}function r(e,t){switch(t){case"char":case"uchar":case"short":case"ushort":case"int":case"uint":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":return parseInt(e);case"float":case"double":case"float32":case"float64":return parseFloat(e)}}function a(e,t){const n={};for(let s=0;s<e.length;s++){if(t.empty())return null;if("list"===e[s].type){const a=[],o=r(t.next(),e[s].countType);for(let n=0;n<o;n++){if(t.empty())return null;a.push(r(t.next(),e[s].itemType))}n[e[s].name]=a}else n[e[s].name]=r(t.next(),e[s].type)}return n}function c(){const e={indices:[],vertices:[],normals:[],uvs:[],faceVertexUvs:[],colors:[],faceVertexColors:[]};for(const t of Object.keys(m.customPropertyMapping))e[t]=[];return e}function i(e){const t=e.map(e=>e.name);function r(e){for(let r=0,n=e.length;r<n;r++){const n=e[r];if(t.includes(n))return n}return null}return{attrX:r(["x","px","posx"])||"x",attrY:r(["y","py","posy"])||"y",attrZ:r(["z","pz","posz"])||"z",attrNX:r(["nx","normalx"]),attrNY:r(["ny","normaly"]),attrNZ:r(["nz","normalz"]),attrS:r(["s","u","texture_u","tx"]),attrT:r(["t","v","texture_v","ty"]),attrR:r(["red","diffuse_red","r","diffuse_r"]),attrG:r(["green","diffuse_green","g","diffuse_g"]),attrB:r(["blue","diffuse_blue","b","diffuse_b"])}}function u(e,t){const r=c();let n,s;n=null!==(s=/end_header\s+(\S[\s\S]*\S|\S)\s*$/.exec(e))?s[1].split(/\s+/):[];const u=new o(n);e:for(let o=0;o<t.elements.length;o++){const e=t.elements[o],n=i(e.properties);for(let t=0;t<e.count;t++){const t=a(e.properties,u);if(!t)break e;p(r,e.name,t,n)}}return l(r)}function l(e){let t=new n.LoY;e.indices.length>0&&t.setIndex(e.indices),t.setAttribute("position",new n.qtW(e.vertices,3)),e.normals.length>0&&t.setAttribute("normal",new n.qtW(e.normals,3)),e.uvs.length>0&&t.setAttribute("uv",new n.qtW(e.uvs,2)),e.colors.length>0&&t.setAttribute("color",new n.qtW(e.colors,3)),(e.faceVertexUvs.length>0||e.faceVertexColors.length>0)&&(t=t.toNonIndexed(),e.faceVertexUvs.length>0&&t.setAttribute("uv",new n.qtW(e.faceVertexUvs,2)),e.faceVertexColors.length>0&&t.setAttribute("color",new n.qtW(e.faceVertexColors,3)));for(const r of Object.keys(m.customPropertyMapping))e[r].length>0&&t.setAttribute(r,new n.qtW(e[r],m.customPropertyMapping[r].length));return t.computeBoundingSphere(),t}function p(e,t,r,a){if("vertex"===t){e.vertices.push(r[a.attrX],r[a.attrY],r[a.attrZ]),null!==a.attrNX&&null!==a.attrNY&&null!==a.attrNZ&&e.normals.push(r[a.attrNX],r[a.attrNY],r[a.attrNZ]),null!==a.attrS&&null!==a.attrT&&e.uvs.push(r[a.attrS],r[a.attrT]),null!==a.attrR&&null!==a.attrG&&null!==a.attrB&&(s.setRGB(r[a.attrR]/255,r[a.attrG]/255,r[a.attrB]/255,n.er$),e.colors.push(s.r,s.g,s.b));for(const t of Object.keys(m.customPropertyMapping))for(const n of m.customPropertyMapping[t])e[t].push(r[n])}else if("face"===t){const t=r.vertex_indices||r.vertex_index,o=r.texcoord;3===t.length?(e.indices.push(t[0],t[1],t[2]),o&&6===o.length&&(e.faceVertexUvs.push(o[0],o[1]),e.faceVertexUvs.push(o[2],o[3]),e.faceVertexUvs.push(o[4],o[5]))):4===t.length&&(e.indices.push(t[0],t[1],t[3]),e.indices.push(t[1],t[2],t[3])),null!==a.attrR&&null!==a.attrG&&null!==a.attrB&&(s.setRGB(r[a.attrR]/255,r[a.attrG]/255,r[a.attrB]/255,n.er$),e.faceVertexColors.push(s.r,s.g,s.b),e.faceVertexColors.push(s.r,s.g,s.b),e.faceVertexColors.push(s.r,s.g,s.b))}}function f(e,t){const r={};let n=0;for(let s=0;s<t.length;s++){const a=t[s],o=a.valueReader;if("list"===a.type){const t=[],s=a.countReader.read(e+n);n+=a.countReader.size;for(let r=0;r<s;r++)t.push(o.read(e+n)),n+=o.size;r[a.name]=t}else r[a.name]=o.read(e+n),n+=o.size}return[r,n]}function h(e,t,r){function n(e,t,r){switch(t){case"int8":case"char":return{read:t=>e.getInt8(t),size:1};case"uint8":case"uchar":return{read:t=>e.getUint8(t),size:1};case"int16":case"short":return{read:t=>e.getInt16(t,r),size:2};case"uint16":case"ushort":return{read:t=>e.getUint16(t,r),size:2};case"int32":case"int":return{read:t=>e.getInt32(t,r),size:4};case"uint32":case"uint":return{read:t=>e.getUint32(t,r),size:4};case"float32":case"float":return{read:t=>e.getFloat32(t,r),size:4};case"float64":case"double":return{read:t=>e.getFloat64(t,r),size:8}}}for(let s=0,a=e.length;s<a;s++){const a=e[s];"list"===a.type?(a.countReader=n(t,a.countType,r),a.valueReader=n(t,a.itemType,r)):a.valueReader=n(t,a.type,r)}}let d;const m=this;if(e instanceof ArrayBuffer){const r=new Uint8Array(e),{headerText:n,headerLength:s}=function(e){let t=0,r=!0,n="";const s=[],a=(new TextDecoder).decode(e.subarray(0,5)),o=/^ply\r\n/.test(a);do{const a=String.fromCharCode(e[t++]);"\n"!==a&&"\r"!==a?n+=a:("end_header"===n&&(r=!1),""!==n&&(s.push(n),n=""))}while(r&&t<e.length);return!0===o&&t++,{headerText:s.join("\r")+"\r",headerLength:t}}(r),a=t(n,s);if("ascii"===a.format){d=u((new TextDecoder).decode(r),a)}else d=function(e,t){const r=c(),n="binary_little_endian"===t.format,s=new DataView(e,t.headerLength);let a,o=0;for(let c=0;c<t.elements.length;c++){const e=t.elements[c],u=e.properties,l=i(u);h(u,s,n);for(let t=0;t<e.count;t++){a=f(o,u),o+=a[1];const t=a[0];p(r,e.name,t,l)}}return l(r)}(e,a)}else d=u(e,t(e));return d}}class o{constructor(e){this.arr=e,this.i=0}empty(){return this.i>=this.arr.length}next(){return this.arr[this.i++]}}}}]);